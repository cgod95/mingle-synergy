import { useParams } from "react-router-dom";
import { getVenueById } from "../lib/demoVenues";
import { likePerson, isMatched, isLiked } from "../lib/likesStore";
import { useState } from "react";

export default function VenueDetails() {
  const { id } = useParams<{ id: string }>();
  const venue = getVenueById(id || "");
  const [liked, setLiked] = useState(false);

  if (!venue) return <div className="p-4">Venue not found</div>;

  const handleLike = (personId: string) => {
    const result = likePerson(personId);
    setLiked(true);
    if (result.status === "matched") {
      alert("Youâ€™ve both liked each other! Added to your matches ðŸŽ‰");
    } else {
      alert("Like sent. If they like you back, you'll match!");
    }
  };

  return (
    <div className="p-4">
      <img
        src={venue.photo || "/default.jpg"}
        alt={venue.name}
        className="w-full h-48 object-cover rounded-xl mb-3"
      />
      <h1 className="text-xl font-semibold mb-1">{venue.name}</h1>
      <p className="text-sm text-neutral-600 mb-4">{venue.location}</p>

      <h2 className="font-medium mb-2">People checked in</h2>
      <div className="grid grid-cols-2 sm:grid-cols-3 gap-3">
        {venue.people.map((p) => (
          <div
            key={p.id}
            onClick={() => handleLike(p.id)}
            className="cursor-pointer bg-white rounded-xl border p-2 text-center hover:shadow-sm"
          >
            <img
              src={p.photo || "/default-user.jpg"}
              alt={p.name}
              className="h-20 w-full object-cover rounded-lg mb-2"
            />
            <div className="text-sm font-medium">{p.name}</div>
            {isMatched(p.id) && (
              <div className="text-xs text-green-600 mt-1">Matched</div>
            )}
            {isLiked(p.id) && !isMatched(p.id) && (
              <div className="text-xs text-blue-500 mt-1">Liked</div>
            )}
          </div>
        ))}
      </div>
    </div>
  );
}
